<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Kn0x-Fit | Fitness Tracker App</title>
<!-- PWA Meta & Manifest -->
<meta content="#1a1a2e" name="theme-color"/>
<link href="./manifest.json" rel="manifest"/>
<meta content="yes" name="mobile-web-app-capable"/>
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/>
<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>
<style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8f9fa;
            color: #1a1a2e;
        }
        .bg-icon {
            position: absolute;
            opacity: 0.03;
            z-index: -1;
            animation: float 6s ease-in-out infinite;
        }
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
            100% { transform: translateY(0px); }
        }
        .gradient-bg {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }
        .upload-area {
            border: 2px dashed #4a5568;
            transition: all 0.3s ease;
        }
        .upload-area:hover, .upload-area.dragover {
            border-color: #ef4444;
            background-color: rgba(239, 68, 68, 0.1);
        }
        .log-entry:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
        }
        .btn-primary {
            background-color: #ef4444;
            transition: all 0.3s ease;
            color: white;
        }
        .btn-primary:hover {
            background-color: #dc2626;
            transform: translateY(-2px);
        }
        .thumbnail {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
        }
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        /* Toast */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background-color: #4CAF50;
            color: white;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transform: translateX(150%);
            transition: transform 0.3s ease;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .toast.show {
            transform: translateX(0);
        }
        .toast.error {
            background-color: #f44336;
        }
        .toast.warning {
            background-color: #ff9800;
        }
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background-color: rgba(0,0,0,0.5);
            z-index: 1001;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: white;
            padding: 25px;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            animation: modalFadeIn 0.3s ease;
        }
        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        /* Custom checkbox */
        .custom-checkbox {
            appearance: none;
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid #ccc;
            border-radius: 4px;
            outline: none;
            cursor: pointer;
            position: relative;
            transition: all 0.2s ease;
        }
        .custom-checkbox:checked {
            background-color: #ef4444;
            border-color: #ef4444;
        }
        .custom-checkbox:checked::after {
            content: '\f00c';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            position: absolute;
            color: white;
            font-size: 12px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .thumbnail {
                width: 80px;
                height: 80px;
            }
            .modal-content {
                width: 95%;
                padding: 15px;
            }
        }
        @media (max-width: 576px) {
            header nav ul {
                gap: 10px;
            }
            .thumbnail {
                width: 60px;
                height: 60px;
            }
        }
    </style>
<!-- Font Awesome -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
</head>
<body class="min-h-screen bg-gray-50">
<!-- Login/Register Modal -->
<div class="modal flex" id="authModal" style="display: flex;">
<div class="modal-content max-w-md">
<div class="text-center mb-6">
<i class="fas fa-dumbbell text-4xl text-rose-600 mb-3"></i>
<h3 class="text-2xl font-bold text-gray-900">Welcome to Kn0x-Fit</h3>
<p class="text-gray-600 mt-1">Track your fitness journey with us</p>
</div>
<div class="tabs flex border-b border-gray-300 mb-6">
<button class="tab-btn active px-4 py-2 font-medium text-gray-900 border-b-2 border-rose-600" id="loginTab" type="button">Login</button>
<button class="tab-btn px-4 py-2 font-medium text-gray-500" id="registerTab" type="button">Register</button>
</div>
<!-- Login Form -->
<form class="space-y-4" id="loginForm">
<div>
<label class="block text-gray-900 mb-1" for="loginIdentifier">Email or Mobile</label>
<input class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-600 focus:border-rose-600" id="loginIdentifier" placeholder="Enter email or mobile number" required="" type="text"/>
</div>
<div>
<label class="block text-gray-900 mb-1" for="loginPassword">Password</label>
<input class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-600 focus:border-rose-600" id="loginPassword" placeholder="Enter password" required="" type="password"/>
</div>
<div class="flex justify-between items-center">
<div class="flex items-center">
<input class="custom-checkbox mr-2" id="rememberMe" type="checkbox"/>
<label class="cursor-pointer text-sm text-gray-900" for="rememberMe">Remember me</label>
</div>
<a class="text-sm text-rose-600 hover:underline" href="#">Forgot password?</a>
</div>
<button class="btn-primary rounded-lg font-medium w-full py-3 flex items-center justify-center space-x-2" type="submit">
<i class="fas fa-right-to-bracket"></i>
<span>Login</span>
</button>
</form>
<!-- Register Form -->
<form class="space-y-4 hidden" id="registerForm">
<div>
<label class="block text-gray-900 mb-1" for="registerName">Full Name</label>
<input class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-600 focus:border-rose-600" id="registerName" placeholder="Enter your full name" required="" type="text"/>
</div>
<div>
<label class="block text-gray-900 mb-1" for="registerEmail">Email</label>
<input class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-600 focus:border-rose-600" id="registerEmail" placeholder="Enter email address" required="" type="email"/>
</div>
<div>
<label class="block text-gray-900 mb-1" for="registerMobile">Mobile Number</label>
<input class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-600 focus:border-rose-600" id="registerMobile" placeholder="Enter mobile number" required="" type="tel"/>
</div>
<div>
<label class="block text-gray-900 mb-1" for="registerPassword">Password</label>
<input class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-600 focus:border-rose-600" id="registerPassword" minlength="6" placeholder="Create password (min 6 chars)" required="" type="password"/>
</div>
<div>
<label class="block text-gray-900 mb-1" for="registerConfirmPassword">Confirm Password</label>
<input class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-600 focus:border-rose-600" id="registerConfirmPassword" placeholder="Confirm password" required="" type="password"/>
</div>
<div class="flex items-center">
<input class="custom-checkbox mr-2" id="acceptTerms" required="" type="checkbox"/>
<label class="text-sm text-gray-900 cursor-pointer" for="acceptTerms">I agree to the <a class="text-rose-600 hover:underline" href="#">Terms &amp; Conditions</a></label>
</div>
<button class="btn-primary rounded-lg font-medium w-full py-3 flex items-center justify-center space-x-2" type="submit">
<i class="fas fa-user-plus"></i>
<span>Register</span>
</button>
</form>
<div class="text-center text-sm text-gray-600 mt-6" id="switchFormText">
            Don't have an account? <a class="text-rose-600 hover:underline" href="#" id="switchFormBtn">Register</a>
</div>
</div>
</div>
<header class="gradient-bg text-white shadow-lg hidden">
<div class="container mx-auto px-4 py-6 flex justify-between items-center">
<div class="flex items-center space-x-2">
<i class="fas fa-dumbbell text-2xl text-rose-600"></i>
<h1 class="text-2xl font-bold">Kn0x-Fit</h1>
</div>
<nav>
<ul class="flex space-x-6">
<li><a class="hover:text-red-400 transition" href="#">Home</a></li>
<li><a class="hover:text-red-400 transition" href="#">Dashboard</a></li>
<li><a class="hover:text-red-400 transition" href="#">Profile</a></li>
<li><a class="hover:text-red-400 transition" href="#"><i class="fas fa-bell"></i></a></li>
<li><a class="hover:text-red-400 transition" href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i></a></li>
</ul>
</nav>
</div>
</header>
<main class="container mx-auto px-4 py-8 max-w-4xl hidden">
<!-- Stats Overview -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
<div class="stat-card bg-white rounded-xl shadow-md p-4 text-center">
<div class="text-3xl font-bold text-gray-900 mb-1" id="logCount">0</div>
<div class="text-sm text-gray-600">Log Entries</div>
<div class="mt-2">
<i class="fas fa-clipboard-list text-rose-600"></i>
</div>
</div>
<div class="stat-card bg-white rounded-xl shadow-md p-4 text-center">
<div class="text-3xl font-bold text-gray-900 mb-1" id="workoutDays">0</div>
<div class="text-sm text-gray-600">Workout Days</div>
<div class="mt-2">
<i class="fas fa-fire text-rose-600"></i>
</div>
</div>
<div class="stat-card bg-white rounded-xl shadow-md p-4 text-center">
<div class="text-3xl font-bold text-gray-900 mb-1" id="consistency">0%</div>
<div class="text-sm text-gray-600" id="consistencyFeedback">Consistency</div>
<div class="mt-2">
<i class="fas fa-chart-line text-green-600"></i>
</div>
</div>
</div>
<!-- New Log Entry -->
<section class="bg-white rounded-xl shadow-md p-6 mb-8">
<h3 class="text-xl font-semibold text-gray-900 mb-4">New Log Entry</h3>
<form class="space-y-6" id="logForm">
<div>
<label class="block text-gray-900 mb-2" for="currentDate"><span id="timeGreeting"></span> Today's Date</label>
<input class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-600 focus:border-rose-600" id="currentDate" readonly="" type="text"/>
<p class="text-xs text-gray-500 mt-1">Automatically detected based on your location</p>
</div>
<div>
<label class="block text-gray-900 mb-2" for="currentTime">Current Time</label>
<input class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-600 focus:border-rose-600" id="currentTime" readonly="" type="text"/>
<p class="text-xs text-gray-500 mt-1">Updates in real-time</p>
</div>
<div>
<label class="block text-gray-900 mb-2" for="weight">Weight (kg)</label>
<input class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-600 focus:border-rose-600" id="weight" placeholder="Enter your current weight" step="0.1" type="number"/>
</div>
<div>
<label class="block text-gray-900 mb-2">Workout Completed</label>
<div class="flex items-center">
<input class="custom-checkbox mr-2" id="workoutCompleted" type="checkbox"/>
<label class="cursor-pointer text-gray-900" for="workoutCompleted">Mark if you completed today's workout</label>
</div>
</div>
<div>
<label class="block text-gray-900 mb-2">Diet Photos</label>
<button class="upload-area rounded-lg p-8 text-center cursor-pointer w-full" id="dietUploadBtn" type="button">
<i class="fas fa-utensils text-4xl text-gray-400 mb-3"></i>
<p class="text-gray-500">Click to select diet photos</p>
</button>
<div class="mt-4 flex flex-wrap gap-3" id="dietPreview"></div>
<input accept="image/*" hidden="" id="dietInput" multiple="" type="file"/>
</div>
<div>
<label class="block text-gray-900 mb-2">Workout Photos</label>
<button class="upload-area rounded-lg p-8 text-center cursor-pointer w-full" id="workoutUploadBtn" type="button">
<i class="fas fa-running text-4xl text-gray-400 mb-3"></i>
<p class="text-gray-500">Click to select workout photos</p>
</button>
<div class="mt-4 flex flex-wrap gap-3" id="workoutPreview"></div>
<input accept="image/*" hidden="" id="workoutInput" multiple="" type="file"/>
</div>
<div>
<label class="block text-gray-900 mb-2" for="notes">Additional Notes</label>
<textarea class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-600 focus:border-rose-600" id="notes" placeholder="Any additional comments about your day..." rows="3"></textarea>
</div>
<button class="btn-primary rounded-lg font-medium w-full py-3 flex items-center justify-center space-x-2" type="submit">
<i class="fas fa-save"></i>
<span>Save Log Entry</span>
</button>
</form>
</section>
<!-- Progress Section -->
<section class="bg-white rounded-xl shadow-md p-6 mb-8">
<h3 class="text-xl font-semibold text-gray-900 mb-4">Your Progress</h3>
<div class="space-y-4">
<div>
<div class="flex justify-between mb-1">
<span class="text-sm font-medium text-gray-900">Weekly Goal Completion</span>
<span class="text-sm font-medium text-gray-900" id="weeklyGoalText">0/7 days</span>
</div>
<div class="progress-container">
<div class="progress-bar" id="weeklyGoalBar" style="width: 0%"></div>
</div>
</div>
<div>
<div class="flex justify-between mb-1">
<span class="text-sm font-medium text-gray-900">AI-Calculated Consistency</span>
<span class="text-sm font-medium text-gray-900" id="monthlyConsistencyText">0%</span>
</div>
<div class="progress-container">
<div class="progress-bar" id="monthlyConsistencyBar" style="width: 0%"></div>
</div>
<p class="text-xs text-gray-500 mt-1">Based on workouts, streaks, frequency &amp; progress</p>
</div>
</div>
</section>
<!-- Previous Entries with Filter -->
<section class="bg-white rounded-xl shadow-md p-6">
<div class="flex justify-between items-center mb-4">
<h3 class="text-xl font-semibold text-gray-900">Previous Entries</h3>
<div class="flex items-center space-x-2">
<select class="px-3 py-1 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-rose-600 focus:border-rose-600" id="filterBy">
<option value="all">All Entries</option>
<option value="week">This Week</option>
<option value="month">This Month</option>
<option value="workout">With Workout</option>
</select>
<button class="px-3 py-1 bg-gray-200 text-gray-700 rounded-lg text-sm hover:bg-gray-300 transition" id="clearFilter">Clear</button>
</div>
</div>
<div class="space-y-4 max-h-[600px] overflow-y-auto pr-2" id="logEntries">
<div class="text-center py-8 text-gray-500" id="noEntriesMessage">
<i class="fas fa-clipboard-list text-4xl mb-3"></i>
<p>No entries found matching your filter. Submit a new log above!</p>
</div>
</div>
</section>
</main>
<footer class="gradient-bg text-white py-8 mt-12 hidden">
<div class="container mx-auto px-4 text-center">
<p>© 2025 Kn0x-Fit. All rights reserved.</p>
<div class="flex justify-center space-x-4 mt-4">
<a class="hover:text-rose-400 transition" href="#"><i class="fab fa-facebook-f"></i></a>
<a class="hover:text-rose-400 transition" href="#"><i class="fab fa-instagram"></i></a>
<a class="hover:text-rose-400 transition" href="#"><i class="fab fa-twitter"></i></a>
<a class="hover:text-rose-400 transition" href="#"><i class="fab fa-youtube"></i></a>
</div>
</div>
</footer>
<!-- Toast Notification -->
<div aria-atomic="true" aria-live="assertive" class="toast" id="toast" role="alert" style="pointer-events:none;">
<i class="fas fa-check-circle"></i>
<span id="toastMessage">Log entry saved successfully!</span>
</div>
<!-- Delete Confirmation Modal -->
<div class="modal" id="deleteModal">
<div class="modal-content">
<div class="text-center mb-4">
<i class="fas fa-exclamation-triangle text-4xl text-rose-600 mb-3"></i>
<h3 class="text-xl font-semibold text-gray-900">Confirm Deletion</h3>
<p class="text-gray-600 mt-1">Are you sure you want to delete this log entry?</p>
</div>
<div class="flex justify-center space-x-4">
<button class="px-4 py-2 bg-gray-300 hover:bg-gray-400 text-gray-700 rounded-lg transition" id="cancelDelete">Cancel</button>
<button class="px-4 py-2 bg-rose-600 hover:bg-rose-700 text-white rounded-lg transition" id="confirmDelete">Delete</button>
</div>
</div>
</div>
<script>
(() => {
    // Mock localStorage keys
    const USERS_KEY = 'kn0xfit-users';
    const LOGS_KEY = 'kn0xfit-logs';
    
    // Elements
    const authModal = document.getElementById('authModal');
    const loginForm = document.getElementById('loginForm');
    const registerForm = document.getElementById('registerForm');
    const loginTab = document.getElementById('loginTab');
    const registerTab = document.getElementById('registerTab');
    const switchFormText = document.getElementById('switchFormText');
    const switchFormBtn = document.getElementById('switchFormBtn');
    
    const mainHeader = document.querySelector('header');
    const mainContent = document.querySelector('main');
    const mainFooter = document.querySelector('footer');
    
    const toast = document.getElementById('toast');
    const toastMessage = document.getElementById('toastMessage');

    const logCountEl = document.getElementById('logCount');
    const workoutDaysEl = document.getElementById('workoutDays');
    const consistencyEl = document.getElementById('consistency');
    const consistencyFeedbackEl = document.getElementById('consistencyFeedback');
    const weeklyGoalText = document.getElementById('weeklyGoalText');
    const weeklyGoalBar = document.getElementById('weeklyGoalBar');
    const monthlyConsistencyText = document.getElementById('monthlyConsistencyText');
    const monthlyConsistencyBar = document.getElementById('monthlyConsistencyBar');

    // Date time display
    const currentDateInput = document.getElementById('currentDate');
    const currentTimeInput = document.getElementById('currentTime');
    const timeGreetingEl = document.getElementById('timeGreeting');

    // Log form inputs
    const weightInput = document.getElementById('weight');
    const workoutCompletedInput = document.getElementById('workoutCompleted');
    const notesInput = document.getElementById('notes');

    // Photo upload inputs and previews
    const dietUploadBtn = document.getElementById('dietUploadBtn');
    const dietInput = document.getElementById('dietInput');
    const dietPreview = document.getElementById('dietPreview');
    let dietFiles = [];

    const workoutUploadBtn = document.getElementById('workoutUploadBtn');
    const workoutInput = document.getElementById('workoutInput');
    const workoutPreview = document.getElementById('workoutPreview');
    let workoutFiles = [];

    // Log entries container
    const logEntriesContainer = document.getElementById('logEntries');
    const noEntriesMessage = document.getElementById('noEntriesMessage');

    // Delete modal
    const deleteModal = document.getElementById('deleteModal');
    const cancelDeleteBtn = document.getElementById('cancelDelete');
    const confirmDeleteBtn = document.getElementById('confirmDelete');
    let entryToDelete = null;

    // App state
    let currentUser = null;
    let users = [];
    let logs = [];

    // Load users and logs from storage
    function loadData() {
        const storedUsers = localStorage.getItem(USERS_KEY);
        const storedLogs = localStorage.getItem(LOGS_KEY);
        users = storedUsers ? JSON.parse(storedUsers) : [
            {
                email: "demo@kn0xfit.com",
                password: "demo123",
                name: "Demo User",
                role: "user"
            },
            {
                email: "admin@kn0xfit.com",
                password: "admin123",
                name: "Admin User",
                role: "admin"
            }
        ];
        logs = storedLogs ? JSON.parse(storedLogs) : [];
    }

    // Save users and logs to localStorage
    function saveData() {
        localStorage.setItem(USERS_KEY, JSON.stringify(users));
        localStorage.setItem(LOGS_KEY, JSON.stringify(logs));
    }

    // Show toast notification
    function showToast(message, type = 'success') {
        toastMessage.textContent = message;
        toast.className = 'toast';
        if(type === 'error') toast.classList.add('error');
        else if(type === 'warning') toast.classList.add('warning');
        toast.classList.add('show');
        setTimeout(() => {
            toast.classList.remove('show');
        }, 3000);
    }

    // Toggle authentication forms
    function toggleAuthForms(toRegister = null) {
        let showRegister = toRegister !== null ? toRegister : registerForm.classList.contains('hidden');
        if(showRegister){
            registerForm.classList.remove('hidden');
            loginForm.classList.add('hidden');
            loginTab.classList.remove('active');
            registerTab.classList.add('active');
            loginTab.classList.remove('text-gray-900');
            loginTab.classList.add('text-gray-500');
            registerTab.classList.remove('text-gray-500');
            registerTab.classList.add('text-gray-900');
            switchFormText.innerHTML = 'Already have an account? <a href="#" id="switchFormBtn" class="text-rose-600 hover:underline">Login</a>';
        } else {
            loginForm.classList.remove('hidden');
            registerForm.classList.add('hidden');
            loginTab.classList.add('active');
            registerTab.classList.remove('active');
            loginTab.classList.remove('text-gray-500');
            loginTab.classList.add('text-gray-900');
            registerTab.classList.remove('text-gray-900');
            registerTab.classList.add('text-gray-500');
            switchFormText.innerHTML = 'Don\'t have an account? <a href="#" id="switchFormBtn" class="text-rose-600 hover:underline">Register</a>';
        }
    }

    // Setup tab click handlers
    loginTab.addEventListener('click', () => toggleAuthForms(false));
    registerTab.addEventListener('click', () => toggleAuthForms(true));
    document.addEventListener('click', e => {
        if(e.target && e.target.id === 'switchFormBtn'){
            e.preventDefault();
            toggleAuthForms();
        }
    });

    // Login form submission
    loginForm.addEventListener('submit', e => {
        e.preventDefault();
        const identifier = document.getElementById('loginIdentifier').value.trim();
        const password = document.getElementById('loginPassword').value.trim();

        if(!identifier || !password){
            showToast('Please fill in both fields', 'error');
            return;
        }

        // Special admin hardcoded login
        if(identifier === 'thekn0xfit@gmail.com' && password === 'dfoxy9845'){
            currentUser = {email: identifier, name: "Admin", role: "admin"};
            showMainApp();
            showToast('Welcome Admin!', 'success');
            return;
        }

        const user = users.find(u => (u.email === identifier || u.mobile === identifier) && u.password === password);
        if(!user){
            showToast('Invalid credentials', 'error');
            return;
        }
        currentUser = user;
        showMainApp();
        showToast(`Welcome back, ${currentUser.name}!`, 'success');
    });

    // Register form submission
    registerForm.addEventListener('submit', e => {
        e.preventDefault();
        const name = document.getElementById('registerName').value.trim();
        const email = document.getElementById('registerEmail').value.trim();
        const mobile = document.getElementById('registerMobile').value.trim();
        const password = document.getElementById('registerPassword').value.trim();
        const confirmPassword = document.getElementById('registerConfirmPassword').value.trim();

        if(!name || !email || !mobile || !password || !confirmPassword){
            showToast('Please fill all fields', 'error');
            return;
        }
        if(password !== confirmPassword){
            showToast('Passwords do not match', 'error');
            return;
        }
        if(password.length < 6){
            showToast('Password must be at least 6 characters', 'error');
            return;
        }
        if(users.some(u => u.email === email)){
            showToast('Email already registered', 'error');
            return;
        }

        users.push({name, email, mobile, password, role: 'user'});
        saveData();
        showToast('Registration successful! Please login.', 'success');
        toggleAuthForms(false);
        registerForm.reset();
    });

    // Show main app interface
    function showMainApp(){
        authModal.style.display = 'none';
        mainHeader.classList.remove('hidden');
        mainContent.classList.remove('hidden');
        mainFooter.classList.remove('hidden');
        updateStats();
    }

    // Logout
    document.getElementById('logoutBtn').addEventListener('click', e => {
        e.preventDefault();
        currentUser = null;
        authModal.style.display = 'flex';
        mainHeader.classList.add('hidden');
        mainContent.classList.add('hidden');
        mainFooter.classList.add('hidden');
        clearDataOnLogout();
        showToast('Logged out successfully', 'success');
    });

    // Clear sensitive data on logout
    function clearDataOnLogout(){
        // Clear form inputs
        loginForm.reset();
        weightInput.value = '';
        workoutCompletedInput.checked = false;
        notesInput.value = '';
        dietFiles = [];
        workoutFiles = [];
        dietPreview.innerHTML = '';
        workoutPreview.innerHTML = '';
        logEntriesContainer.innerHTML = '';
        logEntriesContainer.appendChild(noEntriesMessage);
    }

    // Update date & time every second
    function updateDateTime(){
        const now = new Date();
        const timeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;
        const dateOptions = { year: 'numeric', month: 'long', day: 'numeric', timeZone };
        const timeOptions = { hour: 'numeric', minute: '2-digit', second: '2-digit', hour12: true, timeZone };
        currentDateInput.value = now.toLocaleDateString('en-US', dateOptions);
        currentTimeInput.value = now.toLocaleTimeString('en-US', timeOptions);

        const hour = now.getHours();
        let greeting = hour < 12 ? 'Good morning' : hour < 18 ? 'Good afternoon' : 'Good evening';
        timeGreetingEl.textContent = `${greeting}! It's currently`;
    }
    updateDateTime();
    setInterval(updateDateTime, 1000);

    // Photo upload handlers
    dietUploadBtn.addEventListener('click', () => dietInput.click());
    dietInput.addEventListener('change', e => handleFiles(e.target.files, 'diet'));

    workoutUploadBtn.addEventListener('click', () => workoutInput.click());
    workoutInput.addEventListener('change', e => handleFiles(e.target.files, 'workout'));

    function handleFiles(files, type){
        const previewContainer = type === 'diet' ? dietPreview : workoutPreview;
        previewContainer.innerHTML = '';
        const fileList = [];

        Array.from(files).forEach(file => {
            if(!file.type.startsWith('image/')) return;

            const reader = new FileReader();
            reader.onload = e => {
                const preview = document.createElement('div');
                preview.className = 'relative group';

                const img = document.createElement('img');
                img.src = e.target.result;
                img.className = 'thumbnail';
                img.alt = file.name;

                const removeBtn = document.createElement('button');
                removeBtn.innerHTML = '<i class="fas fa-times"></i>';
                removeBtn.className = 'absolute -top-2 -right-2 bg-rose-600 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity';
                removeBtn.addEventListener('click', () => {
                    preview.remove();
                    if(previewContainer.children.length === 0){
                        previewContainer.innerHTML = `<p class="text-gray-500">No files selected</p>`;
                    }
                    if(type === 'diet'){
                        dietFiles = dietFiles.filter(f => f.name !== file.name);
                    } else {
                        workoutFiles = workoutFiles.filter(f => f.name !== file.name);
                    }
                });

                preview.appendChild(img);
                preview.appendChild(removeBtn);
                previewContainer.appendChild(preview);
            };
            reader.readAsDataURL(file);

            if(type === 'diet'){
                dietFiles.push(file);
            } else {
                workoutFiles.push(file);
            }
        });

        if(files.length === 0){
            previewContainer.innerHTML = `<p class="text-gray-500">No files selected</p>`;
        }
    }

    // Form submission for log entries
    document.getElementById('logForm').addEventListener('submit', e => {
        e.preventDefault();
        const date = currentDateInput.value;
        const time = currentTimeInput.value;
        const weight = parseFloat(weightInput.value);
        const workoutCompleted = workoutCompletedInput.checked;
        const notes = notesInput.value.trim();

        if (isNaN(weight) || weight <= 0) {
            showToast('Please enter a valid weight', 'error');
            return;
        }

        // Create the log entry object
        const entry = {
            id: Date.now(),
            userEmail: currentUser.email,
            date,
            time,
            weight,
            workoutCompleted,
            dietPhotos: dietFiles.map(f => f.name),
            workoutPhotos: workoutFiles.map(f => f.name),
            notes,
        };

        // Save logs locally
        logs.unshift(entry);
        saveData();

        addLogEntryToUI(entry);
        resetLogForm();
        updateStats();
        showToast('Log entry saved successfully!');
    });

    // Add log entry to UI
    function addLogEntryToUI(entry){
        if(noEntriesMessage.parentElement){
            noEntriesMessage.parentElement.removeChild(noEntriesMessage);
        }
        const el = document.createElement('div');
        el.className = 'log-entry bg-gray-50 rounded-lg p-4 shadow-sm hover:shadow-md';

        el.innerHTML = `
            <div class="flex justify-between items-start mb-2">
                <div>
                    <h4 class="font-semibold text-gray-900">${entry.date}</h4>
                    <p class="text-sm text-gray-500">${entry.time}</p>
                </div>
                <button class="text-rose-600 hover:text-rose-800 delete-entry" aria-label="Delete log entry">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
            <div class="mb-1">
                <span class="text-sm font-medium text-gray-900">Weight: </span>
                <span class="text-sm text-gray-700">${entry.weight.toFixed(1)} kg</span>
            </div>
            <div class="mb-3">
                <span class="text-sm font-medium text-gray-900">Workout: </span>
                <span class="text-sm font-medium ${entry.workoutCompleted ? 'text-green-600' : 'text-rose-600'}">
                    <i class="fas ${entry.workoutCompleted ? 'fa-check-circle' : 'fa-times-circle'} mr-1"></i>
                    ${entry.workoutCompleted ? 'Completed' : 'Missed'}
                </span>
            </div>
            <div class="mb-3">
                <h5 class="text-sm font-medium text-gray-900 mb-1">Diet Photos (${entry.dietPhotos.length})</h5>
                <div class="flex flex-wrap gap-2">
                    ${entry.dietPhotos.length > 0 ? entry.dietPhotos.map(f => `<span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">${f}</span>`).join('') : '<span class="text-xs text-gray-500">No diet photos</span>'}
                </div>
            </div>
            <div class="mb-3">
                <h5 class="text-sm font-medium text-gray-900 mb-1">Workout Photos (${entry.workoutPhotos.length})</h5>
                <div class="flex flex-wrap gap-2">
                    ${entry.workoutPhotos.length > 0 ? entry.workoutPhotos.map(f => `<span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">${f}</span>`).join('') : '<span class="text-xs text-gray-500">No workout photos</span>'}
                </div>
            </div>
            ${entry.notes ? `<div class="pt-3 border-t border-gray-200">
                <h5 class="text-sm font-medium text-gray-900 mb-1">Notes</h5>
                <p class="text-sm text-gray-700">${entry.notes}</p>
            </div>` : ''}
        `;
        // Add delete listener
        el.querySelector('.delete-entry').addEventListener('click', () => {
            entryToDelete = entry;
            showDeleteModal(el);
        });
        logEntriesContainer.prepend(el);
    }

    // Reset log form after submission
    function resetLogForm(){
        document.getElementById('logForm').reset();
        dietFiles = [];
        workoutFiles = [];
        dietPreview.innerHTML = '';
        workoutPreview.innerHTML = '';
        updateDateTime();
    }

    // Show delete confirmation modal
    function showDeleteModal(logEntryElement){
        deleteModal.style.display = 'flex';
        entryToDelete.element = logEntryElement;
    }

    // Cancel deletion
    cancelDeleteBtn.addEventListener('click', () => {
        deleteModal.style.display = 'none';
        entryToDelete = null;
    });

    // Confirm deletion
    confirmDeleteBtn.addEventListener('click', () => {
        if(entryToDelete){
            // Remove from logs data
            logs = logs.filter(log => log.id !== entryToDelete.id);
            saveData();

            // Remove UI element
            if(entryToDelete.element && entryToDelete.element.parentNode){
                entryToDelete.element.parentNode.removeChild(entryToDelete.element);
            }

            if(logEntriesContainer.children.length === 0){
                logEntriesContainer.appendChild(noEntriesMessage);
            }

            showToast('Log entry deleted successfully!');
            updateStats();
            deleteModal.style.display = 'none';
            entryToDelete = null;
        }
    });

    // Filter entries display
    document.getElementById('filterBy').addEventListener('change', e => {
        const filterValue = e.target.value;
        const allEntries = Array.from(logEntriesContainer.querySelectorAll('.log-entry'));
        let visibleCount = 0;

        allEntries.forEach(entryEl => {
            const dateStr = entryEl.querySelector('h4').textContent;
            const workoutText = entryEl.querySelector('.mb-3 span').textContent;

            let show = true;
            if(filterValue === 'week'){
                // Shows last 7 days - here simplified to June 14 & 15 for demo
                show = ['June 14, 2023', 'June 15, 2023'].includes(dateStr);
            } else if(filterValue === 'month'){
                // Shows this month (June)
                show = dateStr.includes('June');
            } else if(filterValue === 'workout'){
                show = workoutText.includes('Completed');
            } else if(filterValue === 'all'){
                show = true;
            }

            if(show){
                entryEl.style.display = 'block';
                visibleCount++;
            } else {
                entryEl.style.display = 'none';
            }
        });

        if(visibleCount === 0 && filterValue !== 'all'){
            noEntriesMessage.classList.remove('hidden');
        } else {
            noEntriesMessage.classList.add('hidden');
        }
    });

    // Clear filter
    document.getElementById('clearFilter').addEventListener('click', () => {
        document.getElementById('filterBy').value = 'all';
        Array.from(logEntriesContainer.querySelectorAll('.log-entry')).forEach(el => {
            el.style.display = 'block';
        });
        noEntriesMessage.classList.add('hidden');
    });

    // Calculate consistency scores & update stats
    function updateStats(){
        const entryEls = Array.from(logEntriesContainer.querySelectorAll('.log-entry'));
        const workoutCompletedCount = entryEls.filter(el => el.querySelector('.mb-3 span').textContent.includes('Completed')).length;
        const totalEntries = entryEls.length;
        const weekDays = Math.min(7, totalEntries);
        const weeklyCompletionPercent = weekDays === 0 ? 0 : Math.round((workoutCompletedCount / weekDays) * 100);

        // Prepare logs for AI consistency calc (oldest first)
        const logsForCalc = logs.slice(0, 30).reverse();

        const consistencyScore = calculateConsistencyScore(logsForCalc);

        logCountEl.textContent = totalEntries;
        workoutDaysEl.textContent = workoutCompletedCount;
        consistencyEl.textContent = consistencyScore + '%';

        weeklyGoalText.textContent = `${workoutCompletedCount}/${weekDays} days`;
        weeklyGoalBar.style.width = `${weeklyCompletionPercent}%`;
        monthlyConsistencyText.textContent = `${consistencyScore}%`;
        monthlyConsistencyBar.style.width = `${consistencyScore}%`;

        if(consistencyScore >= 80){
            consistencyFeedbackEl.innerHTML = `<span class="text-green-600">Excellent!</span> Keep it up!`;
        } else if(consistencyScore >= 60){
            consistencyFeedbackEl.innerHTML = `<span class="text-blue-600">Good</span> - Almost there!`;
        } else if(consistencyScore >= 40){
            consistencyFeedbackEl.innerHTML = `<span class="text-yellow-600">Fair</span> - Room for improvement`;
        } else {
            consistencyFeedbackEl.innerHTML = `<span class="text-rose-600">Needs work</span> - Try more workouts`;
        }
    }

    // AI-style consistency calculations supporting functions:
    function calculateConsistencyScore(logs){
        if(logs.length === 0) return 0;

        const workoutCount = logs.filter(l => l.workoutCompleted).length;
        const baseScore = (workoutCount / logs.length) * 100;
        const streakBonus = calculateStreakBonus(logs) * 15; // max 15
        const frequencyBonus = calculateFrequencyBonus(logs) * 10; // max 10
        const progressBonus = calculateProgressBonus(logs) * 5; // max 5

        const finalScore = (baseScore * 0.7) + streakBonus + frequencyBonus + progressBonus;
        return Math.min(Math.round(finalScore), 100);
    }

    function calculateStreakBonus(logs){
        let currentStreak = 0;
        let maxStreak = 0;
        logs.forEach(log => {
            if(log.workoutCompleted){
                currentStreak++;
                maxStreak = Math.max(maxStreak, currentStreak);
            } else {
                currentStreak = 0;
            }
        });
        return maxStreak / 30;
    }

    function calculateFrequencyBonus(logs){
        if(logs.length < 7) return 0;
        const weeklyAvg = logs.filter(l => l.workoutCompleted).length / (logs.length / 7);
        if(weeklyAvg >= 3 && weeklyAvg <= 5){
            return 0.5 + ((weeklyAvg - 3) / 4);
        }
        return 0;
    }

    function calculateProgressBonus(logs){
        if(logs.length < 2) return 0;
        const firstWeight = logs[logs.length-1].weight;
        const lastWeight = logs[0].weight;
        if(lastWeight < firstWeight){
            const progress = (firstWeight - lastWeight) / firstWeight;
            return Math.min(progress * 10, 1);
        }
        return 0;
    }

    // On app load
    function init(){
        loadData();

        // Load previous user entries to UI
        logs.filter(log => log.userEmail === null || !log.userEmail || log.userEmail === currentUser?.email).forEach(addLogEntryToUI);

        updateStats();

        // Show auth modal and listen to inputs
        if(!currentUser){
            authModal.style.display = 'flex';
            mainHeader.classList.add('hidden');
            mainContent.classList.add('hidden');
            mainFooter.classList.add('hidden');
        }
    }
    init();

})();
</script>

<script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-auth-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBZ6hZRwtPRYNgNU_EDFAvWq_9sGvKoCv4",
    authDomain: "kn0xfitlog-auth.firebaseapp.com",
    projectId: "kn0xfitlog-auth",
    storageBucket: "kn0xfitlog-auth.firebasestorage.app",
    messagingSenderId: "232941738904",
    appId: "1:232941738904:web:1dc79f624e10207592a9ed"
  };
  firebase.initializeApp(firebaseConfig);

  function handleLogin() {
    const email = document.getElementById("loginIdentifier").value;
    const password = document.getElementById("loginPassword").value;
    firebase.auth().signInWithEmailAndPassword(email, password)
      .then(() => showApp())
      .catch(error => alert("Login failed: " + error.message));
  }

  function handleRegister() {
    const email = document.getElementById("registerEmail").value;
    const password = document.getElementById("registerPassword").value;
    firebase.auth().createUserWithEmailAndPassword(email, password)
      .then(() => {
        alert("Registration successful!");
        showApp();
      })
      .catch(error => alert("Registration failed: " + error.message));
  }

  function handleLogout() {
    firebase.auth().signOut().then(() => {
      window.location.reload();
    });
  }

  function showApp() {
    const authBox = document.querySelector(".relative.z-50");
    const blurEl = document.querySelector(".blur-sm");
    if (authBox) authBox.style.display = "none";
    if (blurEl) blurEl.classList.remove("blur-sm");
  }

  firebase.auth().onAuthStateChanged(user => {
    if (user) showApp();
  });
</script>
</body>
</html>
